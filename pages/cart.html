<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Checkout - OurShop</title>
    <link
      href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <style>
      .form-input {
        @apply w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-[#CBB89D] focus:border-[#CBB89D];
      }
      .form-label {
        @apply block text-sm font-medium text-gray-700 mb-1;
      }
      .required:after {
        content: " *";
        @apply text-red-500;
      }
      .error-message {
        @apply text-red-500 text-sm mt-1 hidden;
      }
      .error {
        @apply border-red-500;
      }
    </style>
  </head>
  <body class="bg-gray-50 min-h-screen">
    <header>
      <nav class="bg-white shadow-md sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
          <div class="flex justify-between items-center h-16">
            <div class="flex items-center">
              <a href="../index.html" class="flex items-center">
                <i class="fas fa-shopping-bag text-[#CBB89D] text-2xl mr-2"></i>
                <span class="text-xl font-bold text-[#CBB89D]">OurShop</span>
              </a>
            </div>
            <div class="hidden md:flex items-center space-x-8">
              <a href="../index.html" class="text-gray-700 hover:text-[#806044]"
                >Home</a
              >
              <a href="shop.html" class="text-[#CBB89D] hover:text-[#806044]"
                >Shop</a
              >
              <a href="about.html" class="text-gray-700 font-medium">About</a>
              <a href="contact.html" class="text-gray-700 hover:text-[#806044]"
                >Contact</a
              >
              <a
                href="cart.html"
                class="text-gray-700 hover:text-[#806044] relative"
              >
                <i class="fas fa-shopping-cart"></i>
                <span
                  id="cart-count"
                  class="absolute -top-2 -right-3 bg-[#CBB89D] text-white text-xs rounded-full h-5 w-5 flex items-center justify-center"
                  >0</span
                >
              </a>
            </div>
          </div>
        </div>
      </nav>
    </header>

    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
      <h1 class="text-3xl font-bold mb-8">Checkout</h1>

      <div class="grid grid-cols-1 gap-8">
        <!-- Order Summary -->
        <div class="bg-white rounded-lg shadow-md p-6 sticky top-4">
          <h2 class="text-xl font-bold mb-6">Order Summary</h2>
          <div id="order-items" class="mb-6">
            <div id="empty-cart-message" class="text-center py-4">
              <i class="fas fa-shopping-cart text-2xl text-gray-300 mb-2"></i>
              <p class="text-gray-500">Your cart is empty</p>
            </div>
            <div id="order-content" class="hidden">
              <div id="order-items-list" class="space-y-4 mb-4"></div>
              <div class="border-t pt-4">
                <div class="flex justify-between mb-2">
                  <span>Subtotal:</span>
                  <span>$<span id="subtotal">0.00</span></span>
                </div>
                <div class="flex justify-between mb-2">
                  <span>Shipping:</span>
                  <span>$<span id="shipping">5.00</span></span>
                </div>
                <div class="flex justify-between mb-2">
                  <span>Tax (10%):</span>
                  <span>$<span id="tax">0.00</span></span>
                </div>
                <div
                  class="flex justify-between font-bold text-lg mt-4 pt-4 border-t"
                >
                  <span>Total:</span>
                  <span>$<span id="total">0.00</span></span>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Customer Information Form -->
        <div class="bg-white rounded-lg shadow-lg p-8 mb-8 space-y-6">
          <h2 class="text-2xl font-semibold text-gray-800 mb-6">
            Customer Information
          </h2>
          <form id="customer-form" class="space-y-6">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
              <div>
                <label
                  for="full-name"
                  class="block text-lg font-medium text-gray-700 required"
                  >Full Name</label
                >
                <input
                  type="text"
                  id="full-name"
                  class="mt-2 p-3 w-full border border-gray-300 rounded-lg shadow-sm focus:ring-[#CBB89D] focus:border-[#CBB89D]"
                  required
                />
                <p id="full-name-error" class="error-message">
                  Full name is required
                </p>
              </div>
              <div>
                <label
                  for="email"
                  class="block text-lg font-medium text-gray-700 required"
                  >Email</label
                >
                <input
                  type="email"
                  id="email"
                  class="mt-2 p-3 w-full border border-gray-300 rounded-lg shadow-sm focus:ring-[#CBB89D] focus:border-[#CBB89D]"
                  required
                />
                <p id="email-error" class="error-message">
                  Please enter a valid email address
                </p>
              </div>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
              <div>
                <label
                  for="phone"
                  class="block text-lg font-medium text-gray-700"
                  >Phone Number</label
                >
                <input
                  type="tel"
                  id="phone"
                  class="mt-2 p-3 w-full border border-gray-300 rounded-lg shadow-sm focus:ring-[#CBB89D] focus:border-[#CBB89D]"
                />
                <p id="phone-error" class="error-message">
                  Please enter a valid phone number
                </p>
              </div>
              <div>
                <label
                  for="address"
                  class="block text-lg font-medium text-gray-700 required"
                  >Address</label
                >
                <input
                  type="text"
                  id="address"
                  class="mt-2 p-3 w-full border border-gray-300 rounded-lg shadow-sm focus:ring-[#CBB89D] focus:border-[#CBB89D]"
                  required
                />
                <p id="address-error" class="error-message">
                  Address is required
                </p>
              </div>
            </div>
            <div>
              <label for="note" class="block text-lg font-medium text-gray-700"
                >Order Notes (Optional)</label
              >
              <textarea
                id="note"
                rows="4"
                class="mt-2 p-3 w-full border border-gray-300 rounded-lg shadow-sm focus:ring-[#CBB89D] focus:border-[#CBB89D]"
              ></textarea>
            </div>
          </form>
        </div>

        <!-- Payment Options -->
        <div class="bg-white rounded-lg shadow-lg p-8 space-y-6">
          <h2 class="text-2xl font-semibold text-gray-800 mb-6">
            Payment Method
          </h2>
          <div class="space-y-4">
            <div class="flex items-center">
              <input
                id="payment-cod"
                type="radio"
                name="payment"
                value="cod"
                class="h-5 w-5 text-[#CBB89D] focus:ring-[#CBB89D]"
                checked
              />
              <label for="payment-cod" class="ml-3 text-lg text-gray-700"
                >Cash on Delivery</label
              >
            </div>
            <div class="flex items-center">
              <input
                id="payment-bakong"
                type="radio"
                name="payment"
                value="bakong"
                class="h-5 w-5 text-[#CBB89D] focus:ring-[#CBB89D]"
              />
              <label for="payment-bakong" class="ml-3 text-lg text-gray-700"
                >Bakong</label
              >
            </div>
            <div class="flex items-center">
              <input
                id="payment-paypal"
                type="radio"
                name="payment"
                value="paypal"
                class="h-5 w-5 text-[#CBB89D] focus:ring-[#CBB89D]"
              />
              <label for="payment-paypal" class="ml-3 text-lg text-gray-700"
                >PayPal</label
              >
            </div>
            <div class="flex items-center">
              <input
                id="payment-card"
                type="radio"
                name="payment"
                value="card"
                class="h-5 w-5 text-[#CBB89D] focus:ring-[#CBB89D]"
              />
              <label for="payment-card" class="ml-3 text-lg text-gray-700"
                >Credit/Debit Card</label
              >
            </div>
          </div>

          <!-- Card Details (Visible only when Credit/Debit Card is selected) -->
          <div id="card-details" class="space-y-6 hidden">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
              <div>
                <label
                  for="card-number"
                  class="block text-lg font-medium text-gray-700 required"
                  >Card Number</label
                >
                <input
                  type="tel"
                  id="card-number"
                  class="mt-2 p-3 w-full border border-gray-300 rounded-lg shadow-sm focus:ring-[#CBB89D] focus:border-[#CBB89D]"
                  required
                />
                <p id="card-number-error" class="error-message">
                  Please enter a valid 16-digit card number
                </p>
              </div>
              <div>
                <label
                  for="exp-date"
                  class="block text-lg font-medium text-gray-700 required"
                  >Expiration Date</label
                >
                <input
                  type="text"
                  id="exp-date"
                  placeholder="MM/YY"
                  class="mt-2 p-3 w-full border border-gray-300 rounded-lg shadow-sm focus:ring-[#CBB89D] focus:border-[#CBB89D]"
                  required
                />
                <p id="exp-date-error" class="error-message">
                  Please enter a valid expiration date (MM/YY)
                </p>
              </div>
            </div>
            <div>
              <label
                for="cvv"
                class="block text-lg font-medium text-gray-700 required"
                >CVV</label
              >
              <input
                type="tel"
                id="cvv"
                maxlength="4"
                class="mt-2 p-3 w-full border border-gray-300 rounded-lg shadow-sm focus:ring-[#CBB89D] focus:border-[#CBB89D]"
                required
              />
              <p id="cvv-error" class="error-message">
                Please enter a valid 3- or 4-digit CVV
              </p>
            </div>
          </div>
        </div>

        <button
          id="place-order-btn"
          class="w-full bg-[#CBB89D] hover:bg-[#806044] text-white py-3 rounded-lg font-medium transition"
        >
          Place Order
        </button>
        <button
          id="pay-now-btn"
          class="w-full bg-[#CBB89D] hover:bg-[#806044] text-white py-3 rounded-lg font-medium transition hidden"
          disabled
        >
          Pay Now
        </button>
      </div>
    </main>

    <script>
      // Validity check functions
      function isFullNameValid() {
        const fullName = document.getElementById("full-name");
        return !!fullName.value.trim();
      }

      function isEmailValid() {
        const email = document.getElementById("email");
        const emailPattern = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        return !!email.value.trim() && emailPattern.test(email.value.trim());
      }

      function isPhoneValid() {
        const phone = document.getElementById("phone");
        const phonePattern = /^\+?[\d\s-]{8,}$/;
        return !phone.value.trim() || phonePattern.test(phone.value.trim());
      }

      function isAddressValid() {
        const address = document.getElementById("address");
        return !!address.value.trim();
      }

      function isCardNumberValid() {
        const cardNumber = document.getElementById("card-number");
        const cleaned = cardNumber.value.trim().replace(/\D/g, "");
        return cleaned.length === 16;
      }

      function isExpDateValid() {
        const expDate = document.getElementById("exp-date");
        const value = expDate.value.trim();
        const parts = value.split("/");
        if (parts.length !== 2) return false;
        const month = parseInt(parts[0], 10);
        const year = parseInt(parts[1], 10);
        if (isNaN(month) || isNaN(year) || month < 1 || month > 12)
          return false;
        const currentYear = new Date().getFullYear() % 100;
        const currentMonth = new Date().getMonth() + 1;
        return (
          year > currentYear || (year === currentYear && month >= currentMonth)
        );
      }

      function isCVVValid() {
        const cvv = document.getElementById("cvv");
        return /^\d{3,4}$/.test(cvv.value.trim());
      }

      // Update button states
      function updateButtons() {
        const cart = JSON.parse(localStorage.getItem("cart")) || [];
        const isCustomerInfoValid =
          isFullNameValid() &&
          isEmailValid() &&
          isAddressValid() &&
          isPhoneValid();
        const paymentMethod = document.querySelector(
          'input[name="payment"]:checked'
        ).value;
        const placeOrderBtn = document.getElementById("place-order-btn");
        const payNowBtn = document.getElementById("pay-now-btn");

        if (paymentMethod === "card") {
          placeOrderBtn.classList.add("hidden");
          payNowBtn.classList.remove("hidden");
          const isCardValid =
            isCardNumberValid() && isExpDateValid() && isCVVValid();
          payNowBtn.disabled =
            cart.length === 0 || !isCustomerInfoValid || !isCardValid;
        } else {
          placeOrderBtn.classList.remove("hidden");
          payNowBtn.classList.add("hidden");
          placeOrderBtn.disabled = cart.length === 0 || !isCustomerInfoValid;
        }
      }

      // Field validation functions with real-time feedback
      function validateFullName() {
        const fullName = document.getElementById("full-name");
        const error = document.getElementById("full-name-error");
        if (!fullName.value.trim()) {
          fullName.classList.add("error");
          error.classList.remove("hidden");
        } else {
          fullName.classList.remove("error");
          error.classList.add("hidden");
        }
        updateButtons();
      }

      function validateEmail() {
        const email = document.getElementById("email");
        const error = document.getElementById("email-error");
        const emailPattern = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        if (!email.value.trim() || !emailPattern.test(email.value.trim())) {
          email.classList.add("error");
          error.classList.remove("hidden");
        } else {
          email.classList.remove("error");
          error.classList.add("hidden");
        }
        updateButtons();
      }

      function validatePhone() {
        const phone = document.getElementById("phone");
        const error = document.getElementById("phone-error");
        const phonePattern = /^\+?[\d\s-]{8,}$/;
        if (phone.value.trim() && !phonePattern.test(phone.value.trim())) {
          phone.classList.add("error");
          error.classList.remove("hidden");
        } else {
          phone.classList.remove("error");
          error.classList.add("hidden");
        }
        updateButtons();
      }

      function validateAddress() {
        const address = document.getElementById("address");
        const error = document.getElementById("address-error");
        if (!address.value.trim()) {
          address.classList.add("error");
          error.classList.remove("hidden");
        } else {
          address.classList.remove("error");
          error.classList.add("hidden");
        }
        updateButtons();
      }

      function validateCardNumber() {
        const cardNumber = document.getElementById("card-number");
        const error = document.getElementById("card-number-error");
        const cleaned = cardNumber.value.trim().replace(/\D/g, "");
        if (cleaned.length !== 16) {
          cardNumber.classList.add("error");
          error.classList.remove("hidden");
        } else {
          cardNumber.classList.remove("error");
          error.classList.add("hidden");
        }
        updateButtons();
      }

      function validateExpDate() {
        const expDate = document.getElementById("exp-date");
        const error = document.getElementById("exp-date-error");
        if (!isExpDateValid()) {
          expDate.classList.add("error");
          error.classList.remove("hidden");
        } else {
          expDate.classList.remove("error");
          error.classList.add("hidden");
        }
        updateButtons();
      }

      function validateCVV() {
        const cvv = document.getElementById("cvv");
        const error = document.getElementById("cvv-error");
        if (!/^\d{3,4}$/.test(cvv.value.trim())) {
          cvv.classList.add("error");
          error.classList.remove("hidden");
        } else {
          cvv.classList.remove("error");
          error.classList.add("hidden");
        }
        updateButtons();
      }

      // Load cart items and calculate totals
      function loadOrderSummary() {
        const cart = JSON.parse(localStorage.getItem("cart")) || [];
        const orderItemsList = document.getElementById("order-items-list");
        const emptyCartMessage = document.getElementById("empty-cart-message");
        const orderContent = document.getElementById("order-content");
        const cartCount = document.getElementById("cart-count");

        if (cart.length === 0) {
          emptyCartMessage.classList.remove("hidden");
          orderContent.classList.add("hidden");
          cartCount.textContent = "0";
        } else {
          emptyCartMessage.classList.add("hidden");
          orderContent.classList.remove("hidden");
          cartCount.textContent = cart.reduce(
            (sum, item) => sum + item.quantity,
            0
          );

          let subtotal = 0;
          orderItemsList.innerHTML = "";
          cart.forEach((item, index) => {
            const itemElement = document.createElement("div");
            itemElement.classList.add(
              "flex",
              "justify-between",
              "items-center"
            );
            itemElement.innerHTML = `
              <span>${item.title} x${item.quantity}</span>
              <div class="flex items-center">
                <span>$${(item.price * item.quantity).toFixed(2)}</span>
                <button class="ml-4 text-red-500 hover:text-red-700 remove-item" data-index="${index}">
                  <i class="fas fa-trash-alt"></i>
                </button>
              </div>
            `;
            orderItemsList.appendChild(itemElement);
            subtotal += item.price * item.quantity;
          });

          const tax = subtotal * 0.1;
          const total = subtotal + tax + 5;
          document.getElementById("subtotal").textContent = subtotal.toFixed(2);
          document.getElementById("shipping").textContent = "5.00";
          document.getElementById("tax").textContent = tax.toFixed(2);
          document.getElementById("total").textContent = total.toFixed(2);

          document.querySelectorAll(".remove-item").forEach((button) => {
            button.addEventListener("click", () =>
              removeItem(button.dataset.index)
            );
          });
        }
        updateButtons();
      }

      // Remove item from cart
      function removeItem(index) {
        let cart = JSON.parse(localStorage.getItem("cart")) || [];
        cart.splice(index, 1);
        localStorage.setItem("cart", JSON.stringify(cart));
        loadOrderSummary();
      }

      // Form validation on submission
      function validateForm() {
        let isValid = true;
        if (!isFullNameValid()) {
          validateFullName();
          isValid = false;
        }
        if (!isEmailValid()) {
          validateEmail();
          isValid = false;
        }
        if (!isPhoneValid()) {
          validatePhone();
          isValid = false;
        }
        if (!isAddressValid()) {
          validateAddress();
          isValid = false;
        }
        const paymentMethod = document.querySelector(
          'input[name="payment"]:checked'
        ).value;
        if (paymentMethod === "card") {
          if (!isCardNumberValid()) {
            validateCardNumber();
            isValid = false;
          }
          if (!isExpDateValid()) {
            validateExpDate();
            isValid = false;
          }
          if (!isCVVValid()) {
            validateCVV();
            isValid = false;
          }
        }
        return isValid;
      }

      // Toggle card details visibility
      function toggleCardDetails() {
        const paymentMethod = document.querySelector(
          'input[name="payment"]:checked'
        ).value;
        const cardDetails = document.getElementById("card-details");
        if (paymentMethod === "card") {
          cardDetails.classList.remove("hidden");
        } else {
          cardDetails.classList.add("hidden");
        }
        updateButtons();
      }

      // Handle form submission
      document
        .getElementById("place-order-btn")
        .addEventListener("click", (e) => {
          e.preventDefault();
          if (validateForm()) {
            alert("Order placed successfully!");
            localStorage.removeItem("cart");
            loadOrderSummary();
          }
        });

      document.getElementById("pay-now-btn").addEventListener("click", (e) => {
        e.preventDefault();
        if (validateForm()) {
          alert("Payment processed successfully!");
          localStorage.removeItem("cart");
          loadOrderSummary();
        }
      });

      // Add real-time validation and payment method event listeners
      document.addEventListener("DOMContentLoaded", () => {
        loadOrderSummary();
        const fullNameInput = document.getElementById("full-name");
        fullNameInput.addEventListener("input", validateFullName);
        fullNameInput.addEventListener("blur", validateFullName);

        const emailInput = document.getElementById("email");
        emailInput.addEventListener("input", validateEmail);
        emailInput.addEventListener("blur", validateEmail);

        const phoneInput = document.getElementById("phone");
        phoneInput.addEventListener("input", validatePhone);
        phoneInput.addEventListener("blur", validatePhone);

        const addressInput = document.getElementById("address");
        addressInput.addEventListener("input", validateAddress);
        addressInput.addEventListener("blur", validateAddress);

        const cardNumberInput = document.getElementById("card-number");
        cardNumberInput.addEventListener("input", validateCardNumber);
        cardNumberInput.addEventListener("blur", validateCardNumber);

        const expDateInput = document.getElementById("exp-date");
        expDateInput.addEventListener("input", validateExpDate);
        expDateInput.addEventListener("blur", validateExpDate);

        const cvvInput = document.getElementById("cvv");
        cvvInput.addEventListener("input", validateCVV);
        cvvInput.addEventListener("blur", validateCVV);

        document.querySelectorAll('input[name="payment"]').forEach((radio) => {
          radio.addEventListener("change", toggleCardDetails);
        });
      });
    </script>
  </body>
</html>
